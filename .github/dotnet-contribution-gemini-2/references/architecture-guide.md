# 架構概述

本文件描述了專案的核心架構、分層模式與技術堆疊。

## 核心專案
- **JobBank1111.Job.WebAPI**: 主要的 Web API 應用程式
- **JobBank1111.Infrastructure**: 跨領域基礎設施服務
- **JobBank1111.Job.DB**: Entity Framework Core 資料存取層
- **JobBank1111.Job.Contract**: 從 OpenAPI 規格自動產生的 API 客戶端合約

## 分層架構

### 分層模式（Controller → Handler → Repository）
- **Controller 層**: HTTP 請求/回應、路由、請求驗證、HTTP 狀態碼對應
- **Handler 層**: 核心業務邏輯、流程協調、錯誤處理與結果封裝
- **Repository 層**: 資料存取邏輯、EF Core 操作、資料庫查詢封裝

### 組織方式

**方案 A：單一專案結構**
- 所有功能層都在 `JobBank1111.Job.WebAPI` 專案內
- 適合小型團隊（3 人以下）、快速開發
- 優點：編譯快速、部署簡單
- 缺點：程式碼耦合度較高

**方案 B：多專案結構**
- Controller、Handler、Repository 各自獨立專案
- 適合大型團隊、明確分工、長期維護
- 優點：職責清晰分離、便於團隊協作
- 缺點：專案結構較複雜、編譯時間較長

## 技術堆疊
- **框架**: ASP.NET Core 8.0
- **資料庫**: Entity Framework Core 與 SQL Server
- **快取**: Redis 搭配記憶體內快取備援
- **錯誤處理**: CSharpFunctionalExtensions 3.1.0 (Result Pattern)
- **驗證**: FluentValidation 11.10.0
- **日誌記錄**: Serilog 結構化日誌
- **測試**: xUnit 2.9.2、Testcontainers 3.10.0、Reqnroll.xUnit 2.1.1 (BDD)
- **API 文件**: Swagger/OpenAPI 搭配 ReDoc 與 Scalar 檢視器

## 程式碼產生工作流程
1. API 規格維護在 `doc/openapi.yml`
2. 使用 Refitter 產生客戶端程式碼至 `JobBank1111.Job.Contract`
3. 使用 NSwag 產生伺服器控制器至 `JobBank1111.Job.WebAPI/Contract`
4. 使用 EF Core 反向工程產生資料庫實體至 `JobBank1111.Job.DB`

**重要規範**: 
- 所有自動產生的程式碼都放在 `AutoGenerated` 資料夾中，不可手動編輯
- EF Core 反向工程與 Migration 必須透過 Taskfile 執行
