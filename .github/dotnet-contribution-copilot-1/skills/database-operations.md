# Skill: Database Operations

> 資料庫操作 Skill - 處理 EF Core 相關操作

## Skill 職責

- 引導選擇 Code First vs Database First
- 管理 EF Core Migration
- 執行資料庫反向工程
- 確保透過 Taskfile 執行 EF Core 指令

## 引用文件

- [EF Core 最佳實踐](../references/ef-core-best-practices.md)
- [互動規則](../references/interaction-rules.md)

## 執行流程

### 1. 選擇開發模式（強制詢問）

```markdown
請選擇資料庫開發模式：

1️⃣ Code First
   - 定義實體類別
   - 建立 Migration
   - 更新資料庫

2️⃣ Database First
   - 資料庫已存在
   - 反向工程產生實體
   - 使用自動產生的程式碼

請輸入 1 或 2：
```

### 2. Code First 流程

#### Migration 名稱詢問

```markdown
請輸入 Migration 名稱：
（例如：AddMemberTable, UpdateProductSchema）

名稱：
```

#### 執行 Migration

```powershell
# 建立 Migration
task ef-migration-add NAME=AddMemberTable

# 更新資料庫
task ef-database-update

# 如需移除（詢問確認）
task ef-migration-remove
```

### 3. Database First 流程

#### 資料表範圍詢問

```markdown
資料庫反向工程範圍：

1️⃣ 所有資料表
2️⃣ 指定 Schema
3️⃣ 指定資料表清單

請選擇：
```

#### 執行反向工程

```powershell
task ef-codegen
```

**重要提醒**：
- ✅ 自動產生的程式碼放在 `AutoGenerated/` 資料夾
- ❌ 絕對不可手動編輯自動產生的程式碼
- ✅ 使用 Partial Class 擴展功能

### 4. 驗證與測試

執行資料庫操作後：
- 檢查 Migration 檔案
- 確認資料庫 Schema 正確
- 測試 CRUD 操作

## 核心規則

- ✅ **必須透過 Taskfile 執行 EF Core 指令**
- ✅ **不應直接執行 `dotnet ef` 指令**
- ✅ **自動產生的程式碼必須放在 AutoGenerated/**
- ❌ 不可手動編輯自動產生的程式碼

---

**Skill 類型**：資料庫管理  
**適用 Agents**：dotnet-api-developer, project-initializer
