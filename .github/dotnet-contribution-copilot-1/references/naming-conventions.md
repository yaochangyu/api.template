# 命名規範

> 本專案的命名規範與程式碼組織指南

## 檔案與專案命名

### 專案命名

```
{Company}.{Product}.{Layer}

範例：
- JobBank1111.Job.WebAPI        # API 專案
- JobBank1111.Job.DB            # 資料庫專案
- JobBank1111.Infrastructure    # 基礎設施專案
- JobBank1111.Job.Contract      # API 合約專案
- JobBank1111.Job.IntegrationTest # 整合測試專案
```

### 檔案命名

#### Controller
```
{Feature}Controller.cs
{Feature}ControllerImpl.cs  # 實作自動產生的介面

範例：
- MemberController.cs
- OrderController.cs
- ProductController.cs
```

#### Handler
```
{Feature}Handler.cs

範例：
- MemberHandler.cs
- OrderHandler.cs
- ProductHandler.cs
```

#### Repository
```
// 資料表導向
{TableName}Repository.cs

範例：
- MemberRepository.cs
- ProductRepository.cs

// 需求導向
{BusinessDomain}Repository.cs
{AggregateRoot}Repository.cs

範例：
- OrderManagementRepository.cs
- InventoryRepository.cs
- ShoppingCartRepository.cs
```

#### DTO (Data Transfer Object)
```
// Request
{Action}{Feature}Request.cs

範例：
- CreateMemberRequest.cs
- UpdateProductRequest.cs
- SearchOrdersRequest.cs

// Response
{Feature}Response.cs
{Feature}DetailResponse.cs
{Feature}ListResponse.cs

範例：
- MemberResponse.cs
- MemberDetailResponse.cs
- MemberListResponse.cs
```

#### Middleware
```
{Purpose}Middleware.cs

範例：
- TraceContextMiddleware.cs
- ExceptionHandlingMiddleware.cs
- RequestParameterLoggerMiddleware.cs
```

## C# 命名規範

### 類別 (Class)
```csharp
// PascalCase
public class MemberService { }
public class OrderManagementRepository { }
```

### 介面 (Interface)
```csharp
// I + PascalCase
public interface IMemberRepository { }
public interface IContextGetter<T> { }
```

### 方法 (Method)
```csharp
// PascalCase + Async 後綴 (如果是非同步方法)
public async Task<Member> GetByIdAsync(Guid id) { }
public Member GetById(Guid id) { }
```

### 參數 (Parameter)
```csharp
// camelCase
public void CreateMember(string email, string name, int age) { }
```

### 區域變數 (Local Variable)
```csharp
// camelCase
var memberList = new List<Member>();
var isValid = true;
```

### 常數 (Constant)
```csharp
// PascalCase
public const string DefaultConnectionString = "...";
public const int MaxRetryCount = 3;
```

### 私有欄位 (Private Field)
```csharp
// _camelCase (底線開頭)
private readonly ILogger _logger;
private readonly IDbContextFactory<AppDbContext> _dbContextFactory;
```

**注意**：使用主建構函式時，不需要宣告私有欄位
```csharp
// ✅ 推薦：使用主建構函式
public class MemberRepository(IDbContextFactory<AppDbContext> dbContextFactory)
{
    // 直接使用參數名稱，不需宣告欄位
    public async Task<Member> GetByIdAsync(Guid id)
    {
        await using var dbContext = await dbContextFactory.CreateDbContextAsync();
        // ...
    }
}

// ⚠️ 傳統方式（非必要時不使用）
public class MemberRepository
{
    private readonly IDbContextFactory<AppDbContext> _dbContextFactory;
    
    public MemberRepository(IDbContextFactory<AppDbContext> dbContextFactory)
    {
        _dbContextFactory = dbContextFactory;
    }
}
```

### 屬性 (Property)
```csharp
// PascalCase
public string Email { get; set; }
public Guid Id { get; init; }  // 不可變屬性
```

### Record
```csharp
// PascalCase
public record TraceContext
{
    public string TraceId { get; init; }
    public string UserId { get; init; }
}

// Positional record (建構函式參數)
public record Member(Guid Id, string Email, string Name);
```

### 列舉 (Enum)
```csharp
// PascalCase (列舉與成員)
public enum FailureCode
{
    Unauthorized,
    NotFound,
    ValidationError,
    DbError
}
```

## 資料夾結構命名

### 功能導向結構 (單一專案)

```
JobBank1111.Job.WebAPI/
├── Member/                    # 功能資料夾 (PascalCase)
│   ├── MemberController.cs
│   ├── MemberHandler.cs
│   └── MemberRepository.cs
├── Order/
│   ├── OrderController.cs
│   ├── OrderHandler.cs
│   └── OrderRepository.cs
├── Contract/
│   └── AutoGenerated/         # 自動產生的程式碼
└── Middleware/
    ├── TraceContextMiddleware.cs
    └── ExceptionHandlingMiddleware.cs
```

### 測試專案結構

```
JobBank1111.Job.IntegrationTest/
├── _01_Member/                # 測試分類資料夾
│   ├── MemberRegistration.feature
│   ├── MemberQuery.feature
│   └── MemberSteps.cs
├── _02_Order/
│   ├── OrderCreation.feature
│   └── OrderSteps.cs
└── TestServer.cs
```

**規則**：
- 使用 `_XX_` 前綴控制測試執行順序
- PascalCase 功能名稱
- `.feature` 檔案使用 PascalCase

## 方法命名模式

### CRUD 操作

```csharp
// 查詢單一資料
GetByIdAsync(Guid id)
GetByEmailAsync(string email)
FindAsync(Expression<Func<T, bool>> predicate)

// 查詢多筆資料
GetAllAsync()
GetPageAsync(int pageNumber, int pageSize)
SearchAsync(SearchCriteria criteria)

// 建立
CreateAsync(T entity)
AddAsync(T entity)
InsertAsync(T entity)

// 更新
UpdateAsync(T entity)
ModifyAsync(T entity)

// 刪除
DeleteAsync(Guid id)
RemoveAsync(Guid id)

// 檢查存在
ExistsAsync(Guid id)
ExistsByEmailAsync(string email)

// 計數
CountAsync()
CountByStatusAsync(string status)
```

### 業務方法

```csharp
// 動詞 + 名詞 + Async
RegisterMemberAsync(RegisterRequest request)
PlaceOrderAsync(OrderRequest request)
CancelOrderAsync(Guid orderId)
ApprovePaymentAsync(Guid paymentId)
```

### 驗證方法

```csharp
// Is + 形容詞
IsValid(string email)
IsActive(Member member)
IsExpired(DateTime date)

// Can + 動詞
CanRegister(string email)
CanPlaceOrder(Order order)
```

## 變數命名最佳實踐

### 有意義的名稱

```csharp
// ❌ 不好的命名
var m = await GetMemberAsync(id);
var list = await GetDataAsync();
var temp = member.Email;

// ✅ 好的命名
var member = await GetMemberAsync(id);
var members = await GetMembersAsync();
var memberEmail = member.Email;
```

### 避免縮寫

```csharp
// ❌ 避免
var memRepo = new MemberRepository();
var ordMgr = new OrderManager();

// ✅ 完整名稱
var memberRepository = new MemberRepository();
var orderManager = new OrderManager();

// ✅ 例外：廣為人知的縮寫可以使用
var id = Guid.NewGuid();  // ID 是通用縮寫
var url = "https://...";  // URL 是通用縮寫
var dto = new MemberDto();  // DTO 是通用縮寫
```

### 布林變數命名

```csharp
// 使用 is/has/can 前綴
var isValid = ValidateEmail(email);
var hasPermission = CheckPermission(user, resource);
var canDelete = member.Status == "Active";
```

### 集合命名

```csharp
// 使用複數形式
var members = new List<Member>();
var orders = new List<Order>();
var items = new List<OrderItem>();

// 或使用 List/Collection 後綴
var memberList = new List<Member>();
var orderCollection = new List<Order>();
```

## 常數與配置命名

### 設定鍵 (appsettings.json)

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "..."
  },
  "Redis": {
    "ConnectionString": "...",
    "InstanceName": "..."
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  }
}
```

**規則**：
- 使用 PascalCase
- 階層式結構
- 清晰的命名

### 常數類別

```csharp
public static class CacheKeys
{
    public const string MemberPrefix = "member:";
    public const string ProductPrefix = "product:";
    
    public static string MemberById(Guid id) => $"{MemberPrefix}id:{id}";
    public static string MemberByEmail(string email) => $"{MemberPrefix}email:{email}";
}

public static class CacheExpirations
{
    public static readonly TimeSpan StaticData = TimeSpan.FromHours(24);
    public static readonly TimeSpan BusinessData = TimeSpan.FromMinutes(30);
    public static readonly TimeSpan VolatileData = TimeSpan.FromMinutes(5);
}
```

## 命名空間 (Namespace)

```csharp
// 遵循專案與資料夾結構
namespace JobBank1111.Job.WebAPI.Member;
namespace JobBank1111.Job.WebAPI.Middleware;
namespace JobBank1111.Infrastructure.Caching;

// C# 10+ 檔案範圍命名空間 (推薦)
namespace JobBank1111.Job.WebAPI.Member;

public class MemberController { }
```

## Git 分支命名

```
// 功能分支
feature/member-registration
feature/order-management

// 修復分支
fix/login-validation-bug
fix/database-connection-timeout

// 熱修復
hotfix/security-vulnerability

// 發布分支
release/v1.0.0
```

## 資料庫命名 (如果使用 Code First)

### 資料表

```
PascalCase 複數形式

範例：
- Members
- Orders
- OrderItems
- Products
```

### 欄位

```
PascalCase

範例：
- Id
- Email
- CreatedAt
- UpdatedAt
```

### 索引

```
IX_{TableName}_{ColumnName}

範例：
- IX_Members_Email
- IX_Orders_CreatedAt
```

### 外鍵

```
FK_{TableName}_{ReferencedTable}_{ColumnName}

範例：
- FK_Orders_Members_MemberId
- FK_OrderItems_Orders_OrderId
```

## 檢查清單

### 檔案命名
- [ ] Controller: {Feature}Controller.cs
- [ ] Handler: {Feature}Handler.cs
- [ ] Repository: {TableName}Repository.cs 或 {BusinessDomain}Repository.cs
- [ ] DTO: {Action}{Feature}Request.cs / {Feature}Response.cs

### C# 命名
- [ ] 類別/介面/方法：PascalCase
- [ ] 參數/區域變數：camelCase
- [ ] 私有欄位：_camelCase（使用主建構函式時不需要）
- [ ] 常數：PascalCase
- [ ] 非同步方法：加上 Async 後綴

### 語意化
- [ ] 名稱有意義，避免縮寫
- [ ] 布林變數使用 is/has/can 前綴
- [ ] 集合使用複數形式
- [ ] 方法名稱使用動詞開頭

---

**參考來源**：CLAUDE.md - 專案最佳實踐 - 程式碼組織與命名規範
