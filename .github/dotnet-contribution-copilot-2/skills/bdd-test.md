# Skill: bdd-test (BDD æ¸¬è©¦é–‹ç™¼)

## ğŸ“‹ è·è²¬
å»ºç«‹ BDD æ¸¬è©¦ã€ç”¢ç”Ÿ .feature æª”æ¡ˆã€å¯¦ä½œæ¸¬è©¦æ­¥é©Ÿã€è¨­å®šæ¸¬è©¦ç’°å¢ƒ

## ğŸ¯ ä½¿ç”¨æ™‚æ©Ÿ
- éœ€è¦ç‚º API ç«¯é»å»ºç«‹æ¸¬è©¦
- å¯¦ä½œæ–°åŠŸèƒ½éœ€è¦æ¸¬è©¦è¦†è“‹
- å°‡éœ€æ±‚è½‰æ›ç‚ºå¯åŸ·è¡Œçš„æ¸¬è©¦æƒ…å¢ƒ

## ğŸ“ å·¥ä½œæµç¨‹

### 1. è©¢å•æ¸¬è©¦éœ€æ±‚
```
1ï¸âƒ£ æ¸¬è©¦ç¯„åœï¼š
   - æ–°å¢åŠŸèƒ½çš„å®Œæ•´æ¸¬è©¦
   - åƒ…æ¸¬è©¦æ ¸å¿ƒæ¥­å‹™é‚è¼¯
   - åƒ…æ¸¬è©¦ Happy Path
   - åŒ…å«ç•°å¸¸æƒ…å¢ƒèˆ‡é‚Šç•Œæ¢ä»¶

2ï¸âƒ£ æ˜¯å¦å·²æœ‰ .feature æª”æ¡ˆï¼Ÿ
   - âœ… æ˜¯ï¼Œéœ€è¦æ–°å¢æƒ…å¢ƒ
   - âŒ å¦ï¼Œéœ€è¦å¾é ­å»ºç«‹

3ï¸âƒ£ éœ€è¦å”åŠ©æ’°å¯« Gherkin èªæ³•å—ï¼Ÿ
   - âœ… æ˜¯ï¼Œè«‹ AI æ ¹æ“šéœ€æ±‚ç”¢ç”Ÿ
   - âŒ å¦ï¼Œæˆ‘è‡ªå·±æ’°å¯«
```

### 2. è©¢å•æ¸¬è©¦è³‡æ–™ç­–ç•¥
```
1ï¸âƒ£ æ¸¬è©¦è³‡æ–™æº–å‚™æ–¹å¼ï¼š
   - ä½¿ç”¨ Testcontainers (Docker)
   - ä½¿ç”¨å›ºå®š Seed Data
   - æ¯æ¬¡æ¸¬è©¦å‹•æ…‹ç”¢ç”Ÿ
   
2ï¸âƒ£ æ¸¬è©¦å¾Œæ˜¯å¦æ¸…ç†è³‡æ–™ï¼Ÿ
   - âœ… æ˜¯ï¼Œæ¯å€‹æ¸¬è©¦ç¨ç«‹æ¸…ç† (æ¨è–¦)
   - âŒ å¦ï¼Œæ¸¬è©¦çµæŸå¾Œçµ±ä¸€æ¸…ç†
```

### 3. ç”¢ç”Ÿ .feature æª”æ¡ˆ

ä½¿ç”¨ç¯„æœ¬ï¼š[bdd-feature-template.feature](../assets/bdd-feature-template.feature)

```gherkin
# language: zh-TW
åŠŸèƒ½: æœƒå“¡è¨»å†Š
  ä½œç‚ºè¨ªå®¢
  æˆ‘æƒ³è¦è¨»å†Šæˆç‚ºæœƒå“¡
  ä»¥ä¾¿ä½¿ç”¨å®Œæ•´åŠŸèƒ½

  å ´æ™¯: æˆåŠŸè¨»å†Šæ–°æœƒå“¡
    å‡å¦‚ æˆ‘æº–å‚™äº†æœ‰æ•ˆçš„è¨»å†Šè³‡æ–™
      | Email            | Name      |
      | test@example.com | Test User |
    ç•¶ æˆ‘å‘¼å« POST /api/members API
    é‚£éº¼ å›æ‡‰ç‹€æ…‹ç¢¼æ‡‰è©²æ˜¯ 201 Created
    è€Œä¸” å›æ‡‰æœ¬æ–‡æ‡‰è©²åŒ…å«æœƒå“¡ ID
```

### 4. å¯¦ä½œæ¸¬è©¦æ­¥é©Ÿ

ä½¿ç”¨ç¯„æœ¬ï¼š[bdd-steps-template.cs](../assets/bdd-steps-template.cs)

```csharp
[Binding]
public class MemberRegistrationSteps
{
    private readonly HttpClient _client;
    private readonly TestAssistant _assistant;
    
    [Given(@"æˆ‘æº–å‚™äº†æœ‰æ•ˆçš„è¨»å†Šè³‡æ–™")]
    public void GivenValidData(Table table)
    {
        // å¯¦ä½œé‚è¼¯
    }
    
    [When(@"æˆ‘å‘¼å« POST /api/members API")]
    public async Task WhenCallPostApi()
    {
        // å¯¦ä½œé‚è¼¯
    }
    
    [Then(@"å›æ‡‰ç‹€æ…‹ç¢¼æ‡‰è©²æ˜¯ (\d+) (.*)")]
    public void ThenStatusCodeShouldBe(int code, string text)
    {
        // å¯¦ä½œé‚è¼¯
    }
}
```

### 5. è¨­å®šæ¸¬è©¦ç’°å¢ƒ

ç¢ºèª Docker æ¸¬è©¦ç’°å¢ƒå·²è¨­å®šï¼š

```csharp
// TestServer.cs
public class TestServer : WebApplicationFactory<Program>
{
    private static readonly MsSqlContainer _sqlContainer;
    private static readonly RedisContainer _redisContainer;
    
    // å®¹å™¨è¨­å®š...
}
```

## ğŸ¨ Gherkin èªæ³•æœ€ä½³å¯¦è¸

### âœ… ä½¿ç”¨æ¥­å‹™èªè¨€
```gherkin
# å¥½çš„å¯«æ³•
å ´æ™¯: æœƒå“¡å‡ç´šç‚º VIP
  å‡å¦‚ æœƒå“¡ç´¯ç©æ¶ˆè²»é‡‘é¡é”åˆ° 10000 å…ƒ
  ç•¶ ç³»çµ±åŸ·è¡Œæœƒå“¡ç­‰ç´šæ›´æ–°
  é‚£éº¼ æœƒå“¡ç­‰ç´šæ‡‰è©²å‡ç´šç‚º "VIP"

# é¿å…çš„å¯«æ³•  
Scenario: Update member level in database
  Given MemberTotalAmount >= 10000
  When Execute UpdateMemberLevelJob
  Then Members.Level = "VIP"
```

### âœ… ä½¿ç”¨åƒæ•¸åŒ–æƒ…å¢ƒ
```gherkin
å ´æ™¯å¤§ç¶±: æœƒå“¡ç­‰ç´šå‡ç´šè¦å‰‡
  å‡å¦‚ æœƒå“¡ç´¯ç©æ¶ˆè²»é‡‘é¡ç‚º <amount> å…ƒ
  ç•¶ ç³»çµ±åŸ·è¡Œæœƒå“¡ç­‰ç´šæ›´æ–°
  é‚£éº¼ æœƒå“¡ç­‰ç´šæ‡‰è©²æ˜¯ "<level>"
  
  ç¯„ä¾‹:
    | amount | level    |
    | 5000   | ä¸€èˆ¬æœƒå“¡ |
    | 10000  | VIP æœƒå“¡ |
    | 50000  | ç™½é‡‘æœƒå“¡ |
```

### âœ… ä½¿ç”¨èƒŒæ™¯è³‡æ–™
```gherkin
èƒŒæ™¯:
  å‡å¦‚ ç³»çµ±ä¸­å­˜åœ¨ä»¥ä¸‹æœƒå“¡
    | Email            | Level |
    | vip@example.com  | VIP   |
    | user@example.com | ä¸€èˆ¬  |
```

## ğŸ³ Docker æ¸¬è©¦ç’°å¢ƒ

### å¿…é ˆä½¿ç”¨ Testcontainers
```
âœ… SQL Server å®¹å™¨
âœ… Redis å®¹å™¨  
âœ… Seq æ—¥èªŒå®¹å™¨ (é¸ç”¨)
âŒ ç¦æ­¢ä½¿ç”¨ Mock æ›¿ä»£è³‡æ–™åº«
âŒ ç¦æ­¢ä½¿ç”¨ InMemory è³‡æ–™åº«ï¼ˆé™¤éæœ‰ç‰¹æ®Šç†ç”±ï¼‰
```

### åƒ…åœ¨ä»¥ä¸‹æƒ…æ³ä½¿ç”¨ Mock
- å¤–éƒ¨ç¬¬ä¸‰æ–¹ APIï¼ˆç„¡æ³•å®¹å™¨åŒ–ï¼‰
- ä»˜è²»æœå‹™ï¼ˆé¿å…æ¸¬è©¦ç”¢ç”Ÿè²»ç”¨ï¼‰
- ç¡¬é«”ç›¸é—œæœå‹™ï¼ˆç„¡æ³•è™›æ“¬åŒ–ï¼‰

## ğŸš« ç¦æ­¢è¡Œç‚º
- âŒ ä¸å¯è·³éæ¸¬è©¦è³‡æ–™ç­–ç•¥è©¢å•
- âŒ ä¸å¯å° Controller é€²è¡Œå–®å…ƒæ¸¬è©¦
- âŒ ä¸å¯åœ¨æ²’æœ‰ Docker ç’°å¢ƒæ™‚ä½¿ç”¨ InMemory æ›¿ä»£ï¼ˆæ‡‰å‘ŠçŸ¥ç”¨æˆ¶ï¼‰
- âŒ ä¸å¯å‡è¨­ç”¨æˆ¶éœ€è¦æˆ–ä¸éœ€è¦æ¸¬è©¦

## âœ… æˆåŠŸæ¢ä»¶
- [x] ç”¢ç”Ÿå®Œæ•´çš„ .feature æª”æ¡ˆ
- [x] å¯¦ä½œæ‰€æœ‰æ¸¬è©¦æ­¥é©Ÿ
- [x] æ¸¬è©¦å¯é€é `task test-integration` åŸ·è¡Œ
- [x] Docker æ¸¬è©¦ç’°å¢ƒæ­£å¸¸é‹ä½œ
- [x] æ¸¬è©¦è³‡æ–™å¯æ­£ç¢ºæ¸…ç†

## ğŸ“š åƒè€ƒæ–‡ä»¶
- BDD å·¥ä½œæµç¨‹: [@references/bdd-workflow.md](../references/bdd-workflow.md)
- æ¸¬è©¦ç­–ç•¥æŒ‡å—: [@references/testing-strategy.md](../references/testing-strategy.md)

## ğŸ’¡ ä½¿ç”¨ç¯„ä¾‹

```bash
# ä½¿ç”¨æ­¤ skill
@bdd-test ç‚ºæœƒå“¡è¨»å†ŠåŠŸèƒ½å»ºç«‹ BDD æ¸¬è©¦

# AI è©¢å•ç¯„ä¾‹
> 1ï¸âƒ£ æ¸¬è©¦ç¯„åœï¼š
>    a. å®Œæ•´æ¸¬è©¦ï¼ˆæˆåŠŸ+å¤±æ•—+é‚Šç•Œï¼‰
>    b. åƒ…æ¸¬è©¦ Happy Path
>    c. åƒ…æ¸¬è©¦æ ¸å¿ƒé‚è¼¯
> 
> 2ï¸âƒ£ æ˜¯å¦å·²æœ‰ .feature æª”æ¡ˆï¼Ÿ
>    a. æ˜¯ï¼Œéœ€è¦æ–°å¢æƒ…å¢ƒ
>    b. å¦ï¼Œå¾é ­å»ºç«‹
```

## ğŸ”— ç›¸é—œ Skills
- `api-dev` - é…åˆå»ºç«‹ API å¯¦ä½œ
- `code-review` - æª¢æŸ¥æ¸¬è©¦è¦†è“‹ç‡

## ğŸ”— ç›¸é—œ Agents
- `feature-dev-agent` - åŠŸèƒ½é–‹ç™¼æµç¨‹ï¼ˆåŒ…å«æ¸¬è©¦ï¼‰
- `quality-assurance-agent` - å“è³ªä¿è­‰æµç¨‹ï¼ˆä½¿ç”¨æ­¤ skillï¼‰
